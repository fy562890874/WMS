# 用例分析与功能结构分析

## 一、系统概述

本仓储管理系统旨在为企业提供多仓库、多货品的仓储管理解决方案，实现对货品、库存、出入库等信息的高效管理。系统主要包括以下功能模块：

1. 用户管理
2. 个人信息管理
3. 企业基本信息管理
4. 仓库管理
5. 货品类别管理
6. 货品信息管理
7. 出入库管理
8. 权限管理（附加功能，评优）
9. 数据统计分析1
10. 数据统计分析2（附加功能，评优）
11. 系统日志管理（新增需求）

## 二、用例分析

### 1. 用户管理

**角色：** 超级管理员  
**功能：**

- **添加新用户**

  - **描述：** 超级管理员可以创建新用户，填写账号名、用户名、密码、分配角色等信息。
  - **主参与者：** 超级管理员
  - **前置条件：** 超级管理员已登录系统。
  - **后置条件：** 新用户被添加到系统中，用户表 `xmut_user` 更新。
  - **异常情况：**
    - 输入的信息不完整或不合法（如账号名重复），给出错误提示。

- **编辑用户信息**

  - **描述：** 超级管理员可以修改现有用户的信息，包括用户名、角色等。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户已存在。
  - **后置条件：** 用户信息被更新，用户表 `xmut_user` 更新。
  - **异常情况：**
    - 输入的信息不合法，给出错误提示。

- **删除用户**

  - **描述：** 超级管理员可以删除用户账号。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户已存在。
  - **后置条件：** 用户被标记为删除或从数据库中移除。
  - **异常情况：**
    - 无法删除超级管理员自己，给出提示。

- **重置用户密码**

  - **描述：** 超级管理员可以为用户重置密码。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户已存在。
  - **后置条件：** 用户的密码被重置，可能需要通知用户新密码。
  - **异常情况：**
    - 重置失败，给出错误提示。

- **启用/禁用用户**

  - **描述：** 超级管理员可以启用或禁用用户账号。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户已存在。
  - **后置条件：** 用户状态更新，`status` 字段更新。
  - **异常情况：**
    - 无法禁用超级管理员自己，给出提示。

- **用户角色管理**

  - **描述：** 分配或更改用户的角色。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户和角色已存在。
  - **后置条件：** 用户角色关联表 `xmut_user_role` 更新。
  - **异常情况：**
    - 角色不存在，给出错误提示。

### 2. 个人信息管理

**角色：** 所有登录用户  
**功能：**

- **查看个人信息**

  - **描述：** 用户可以查看自己的账号名、用户名、角色等信息。
  - **主参与者：** 登录用户
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

- **更新个人信息**

  - **描述：** 用户可以修改自己的个人资料，如用户名、联系方式等。
  - **主参与者：** 登录用户
  - **前置条件：** 用户已登录。
  - **后置条件：** 用户信息被更新。
  - **异常情况：**
    - 输入的信息不合法，给出错误提示。

- **修改密码**

  - **描述：** 用户可以修改自己的登录密码，需输入旧密码验证。
  - **主参与者：** 登录用户
  - **前置条件：** 用户已登录。
  - **后置条件：** 密码被更新。
  - **异常情况：**
    - 旧密码输入错误，给出提示。

### 3. 企业基本信息管理

**角色：** 信息管理员  
**功能：**

- **查看企业信息**

  - **描述：** 信息管理员可以查看企业的基本信息，包括名称、地址、联系人等。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

- **修改企业信息**

  - **描述：** 信息管理员可以更新企业的基本信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 企业信息已存在。
  - **后置条件：** 企业信息表 `xmut_company` 被更新。
  - **异常情况：**
    - 输入的信息不合法，给出错误提示。

### 4. 仓库管理

**角色：** 信息管理员  
**功能：**

- **添加仓库**

  - **描述：** 信息管理员可以创建新仓库，输入仓库名称、地址等信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 仓库表 `xmut_warehouse` 更新。
  - **异常情况：**
    - 仓库名称重复，给出错误提示。

- **编辑仓库信息**

  - **描述：** 修改仓库的详细信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 仓库已存在。
  - **后置条件：** 仓库信息被更新。
  - **异常情况：**
    - 仓库不存在，给出错误提示。

- **删除仓库**

  - **描述：** 信息管理员可以删除仓库（需确保仓库内无货品）。
  - **主参与者：** 信息管理员
  - **前置条件：** 仓库已存在，且仓库内无货品库存。
  - **后置条件：** 仓库被删除。
  - **异常情况：**
    - 仓库内有货品，无法删除，提示用户先清空货品。

- **查看仓库列表**

  - **描述：** 查看所有仓库的信息列表。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

### 5. 货品类别管理

**角色：** 信息管理员  
**功能：**

- **添加货品类别**

  - **描述：** 创建新的货品类别，输入类别名称、描述等信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 类别表 `xmut_category` 更新。
  - **异常情况：**
    - 类别名称重复，给出错误提示。

- **编辑货品类别**

  - **描述：** 修改类别名称和描述。
  - **主参与者：** 信息管理员
  - **前置条件：** 类别已存在。
  - **后置条件：** 类别信息被更新。
  - **异常情况：**
    - 类别不存在，给出错误提示。

- **删除货品类别**

  - **描述：** 删除选定的货品类别（需确保类别下无货品）。
  - **主参与者：** 信息管理员
  - **前置条件：** 类别已存在，且该类别下无货品。
  - **后置条件：** 类别被删除。
  - **异常情况：**
    - 类别下有货品，无法删除，提示先处理货品。

- **查看货品类别列表**

  - **描述：** 查看所有货品类别。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

### 6. 货品信息管理

**角色：** 信息管理员  
**功能：**

- **添加货品**

  - **描述：** 输入货品名称、价格、类别、上传图片等信息，创建新货品。
  - **主参与者：** 信息管理员
  - **前置条件：** 类别已存在。
  - **后置条件：** 货品表 `xmut_product` 更新。
  - **异常情况：**
    - 货品名称重复，给出错误提示。

- **编辑货品信息**

  - **描述：** 修改货品的详细信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品已存在。
  - **后置条件：** 货品信息被更新。
  - **异常情况：**
    - 货品不存在，给出错误提示。

- **删除货品**

  - **描述：** 删除选定的货品。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品已存在。
  - **后置条件：** 货品被删除，库存表 `xmut_stock` 相应更新。
  - **异常情况：**
    - 货品在库存中有记录，需先清空库存，给出提示。

- **查看货品列表**

  - **描述：** 显示所有货品的信息。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

- **库存调整**

  - **描述：** 手动调整货品在某仓库的库存数量。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品和仓库已存在。
  - **后置条件：** 库存表 `xmut_stock` 更新。
  - **异常情况：**
    - 输入的数量不合法，给出错误提示。

- **货品图片上传**

  - **描述：** 为货品上传或更新图片。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品已存在。
  - **后置条件：** 货品表 `xmut_product` 的 `image_url` 字段更新。
  - **异常情况：**
    - 图片格式不支持，给出错误提示。

### 7. 出入库管理

**角色：** 信息管理员  
**功能：**

- **货品入库**

  - **描述：** 登记货品的入库信息，增加库存。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品和仓库已存在。
  - **后置条件：** 出入库记录表 `xmut_inventory_record` 更新，库存表 `xmut_stock` 更新。
  - **异常情况：**
    - 输入的数量不合法，给出错误提示。

- **货品出库**

  - **描述：** 登记货品的出库信息，减少库存。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品和仓库已存在，库存足够。
  - **后置条件：** 出入库记录表 `xmut_inventory_record` 更新，库存表 `xmut_stock` 更新。
  - **异常情况：**
    - 库存不足，给出错误提示。

- **调货管理**

  - **描述：** 从一个仓库调拨货品到另一个仓库，生成对应的出入库记录。
  - **主参与者：** 信息管理员
  - **前置条件：** 货品和仓库已存在，源仓库库存足够。
  - **后置条件：** 出入库记录表新增两条记录，库存表 `xmut_stock` 更新。
  - **异常情况：**
    - 库存不足，给出错误提示。

- **查看出入库记录**

  - **描述：** 查询和浏览所有的出入库记录，可按条件筛选。
  - **主参与者：** 信息管理员
  - **前置条件：** 用户已登录。
  - **后置条件：** 无
  - **异常情况：**
    - 无

### 8. 权限管理（附加功能，评优）

**角色：** 超级管理员  
**功能：**

- **菜单权限分配**

  - **描述：** 为角色分配可访问的系统菜单和功能模块。
  - **主参与者：** 超级管理员
  - **前置条件：** 角色和权限已存在。
  - **后置条件：** 角色权限关联表 `xmut_role_permission` 更新。
  - **异常情况：**
    - 无

- **仓库权限设置**

  - **描述：** 为用户分配可操作的仓库范围。
  - **主参与者：** 超级管理员
  - **前置条件：** 用户和仓库已存在。
  - **后置条件：** 用户仓库关联表 `xmut_user_warehouse` 更新。
  - **异常情况：**
    - 无

### 9. 数据统计分析1

**角色：** 信息管理员  
**功能：**

- **企业货品进出统计**

  - **描述：** 按时间段统计企业每天货品的进出情况，使用折线图展示。
  - **主参与者：** 信息管理员
  - **前置条件：** 有足够的出入库数据。
  - **后置条件：** 生成统计图表。
  - **异常情况：**
    - 时间段内无数据，提示无记录。

- **货物排行分析**

  - **描述：** 按时间段统计企业进出货物数量的前十名，列表显示商品名称和数量。
  - **主参与者：** 信息管理员
  - **前置条件：** 有足够的出入库数据。
  - **后置条件：** 生成排行列表。
  - **异常情况：**
    - 时间段内无数据，提示无记录。

### 10. 数据统计分析2（附加功能，评优）

**角色：** 超级管理员  
**功能：**

- **仓库货品进出统计**

  - **描述：** 按时间段统计每个仓库每天货品的进出情况，使用折线图展示。
  - **主参与者：** 超级管理员
  - **前置条件：** 有足够的出入库数据。
  - **后置条件：** 生成各仓库的统计图表。
  - **异常情况：**
    - 时间段内无数据，提示无记录。

- **仓库货物排行分析**

  - **描述：** 按时间段统计每个仓库进出货物数量的前十名，列表显示仓库、商品和数量。
  - **主参与者：** 超级管理员
  - **前置条件：** 有足够的出入库数据。
  - **后置条件：** 生成各仓库的排行列表。
  - **异常情况：**
    - 时间段内无数据，提示无记录。

### 11. 系统日志管理（新增需求）

**角色：** 超级管理员、信息管理员  
**功能：**

- **日志记录**

  - **描述：** 系统自动记录用户的操作行为，存入日志文件或数据库。
  - **主参与者：** 系统
  - **前置条件：** 用户进行操作。
  - **后置条件：** 日志表 `xmut_log` 更新。
  - **异常情况：**
    - 日志记录失败，需确保日志系统正常运行。

- **查看日志**

  - **描述：** 管理员可以查看系统日志，追踪用户行为。
  - **主参与者：** 超级管理员
  - **前置条件：** 日志已存在。
  - **后置条件：** 显示日志列表。
  - **异常情况：**
    - 无日志记录，提示无数据。

## 三、功能结构分析

### 1. 系统功能模块划分

- **用户管理模块**
  - 用户添加、编辑、删除、重置密码、启用/禁用、角色管理
- **个人信息管理模块**
  - 查看个人信息、修改信息、修改密码
- **企业信息管理模块**
  - 查看企业信息、修改企业信息
- **仓库管理模块**
  - 仓库添加、编辑、删除、查看列表
- **货品类别管理模块**
  - 类别添加、编辑、删除、查看列表
- **货品信息管理模块**
  - 货品添加、编辑、删除、查看列表、库存调整、图片上传
- **出入库管理模块**
  - 货品入库、出库、调拨、出入库记录查询
- **权限管理模块**
  - 菜单权限分配、仓库权限设置
- **数据统计分析模块**
  - 企业统计分析、仓库统计分析
- **系统日志管理模块**
  - 日志记录、日志查看

### 2. 模块与数据库表的对应关系

- **用户管理模块**
  - `xmut_user`
  - `xmut_role`
  - `xmut_user_role`
- **权限管理模块**
  - `xmut_role`
  - `xmut_permission`
  - `xmut_role_permission`
  - `xmut_user_warehouse`
- **企业信息管理模块**
  - `xmut_company`
- **仓库管理模块**
  - `xmut_warehouse`
- **货品类别管理模块**
  - `xmut_category`
- **货品信息管理模块**
  - `xmut_product`
  - `xmut_stock`
- **出入库管理模块**
  - `xmut_inventory_record`
  - `xmut_stock`
- **数据统计分析模块**
  - `xmut_inventory_record`
  - `xmut_stock`
  - 关联 `xmut_product`、`xmut_warehouse` 等表
- **系统日志管理模块**
  - `xmut_log`

### 3. 功能流程分析

- **用户认证流程**
  - 用户登录时提供账号和密码
  - 系统验证账号密码是否正确
  - 使用 Token 机制，生成 Token，设置过期时间
  - 返回 Token 给前端，后续请求需附带 Token

- **权限验证流程**
  - 系统根据 Token 获取用户信息和角色
  - 查询用户的权限（菜单权限、功能权限）
  - 验证用户是否有权限访问请求的资源

- **出入库操作流程**
  - 用户选择货品和仓库，输入数量
  - 系统校验库存是否足够（出库或调拨时）
  - 更新库存表 `xmut_stock`
  - 记录出入库记录到 `xmut_inventory_record`
  - 日志记录操作

- **调拨操作流程**
  - 用户选择源仓库和目标仓库，输入货品和数量
  - 系统校验源仓库库存
  - 生成出库记录和入库记录，关联 `related_record_id`
  - 更新两个仓库的库存

- **统计分析流程**
  - 用户选择时间段、仓库（可选）
  - 系统从 `xmut_inventory_record` 中查询数据
  - 按日期汇总进出库数量，生成图表数据
  - 按货品汇总，生成排行数据

### 4. 系统安全与日志

- **密码加密**
  - 用户密码在存储时需加密，如使用 MD5、SHA-256 等算法
- **图形验证码**
  - 登录时提供图形验证码，防止暴力破解
- **Token 过期机制**
  - Token 设置过期时间，定期刷新或重新登录
- **日志记录**
  - 系统操作日志记录到 `xmut_log`，包括操作人、操作内容、时间、IP 地址
  - 关键操作需重点记录，如删除数据、权限变更等

### 5. 系统性能与优化

- **使用 Redis 缓存**
  - 缓存常用数据，如权限信息、商品信息，减少数据库访问
  - 缓存 Token，提高验证效率
- **分页查询**
  - 大数据量的列表，采用分页加载，减轻服务器压力
- **数据库索引**
  - 在常用的查询条件列上建立索引，提高查询速度
- **单元测试**
  - 使用 JUnit 对关键业务逻辑进行测试，保证代码质量

## 四、总结

通过上述用例分析和功能结构分析，明确了系统的各个功能模块、参与角色、操作流程以及与数据库表的对应关系。这有助于指导系统的开发和实现，确保各个功能满足需求，并提高系统的可维护性和扩展性。